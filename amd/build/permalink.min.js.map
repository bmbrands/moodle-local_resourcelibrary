{"version":3,"file":"permalink.min.js","sources":["../src/permalink.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * A javascript module to display the current's filter permanent link\n *\n * @copyright  2020 CALL Learning 2020 - Laurent David laurent@call-learning.fr\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/config', 'core/templates'], function ($, config, Templates) {\n\n    var Permalink = {};\n    Permalink.catalogURL = null;\n    Permalink.setupCopyLink = function (triggerid, targetid) {\n        document.querySelector(\"#\" + triggerid).addEventListener(\"click\",\n            function () {\n                document.getElementById(targetid).select();\n                document.execCommand(\"copy\");\n            });\n    };\n\n    Permalink.init = function () {\n        Permalink.catalogURL = new URL(window.location.href);\n        $(document).on('resourcelibrary-filters-change', function (e, filterarray) {\n                filterarray.forEach(function (f) {\n                    const fieldname = 'customfield_' + f.shortname;\n                    if (f.value) {\n                        Permalink.catalogURL.searchParams.append(fieldname + '[operator]', f.operator);\n                        Permalink.catalogURL.searchParams.append(fieldname + '[value]', f.value);\n                        Permalink.catalogURL.searchParams.append(fieldname + '[type]', f.type);\n                    }\n                });\n                Templates.render('local_resourcelibrary/permalink',\n                    {url: Permalink.catalogURL.toString()}).then(\n                    function (html, js) {\n                        Templates.replaceNodeContents('#resourcelibrary-permalink', html, js);\n                    }\n                );\n            }\n        );\n    };\n    return Permalink;\n});\n"],"names":["define","$","config","Templates","Permalink","triggerid","targetid","document","querySelector","addEventListener","getElementById","select","execCommand","catalogURL","URL","window","location","href","on","e","filterarray","forEach","f","fieldname","shortname","value","searchParams","append","operator","type","render","url","toString","then","html","js","replaceNodeContents"],"mappings":";;;;;;AAoBAA,yCAAO,CAAC,SAAU,cAAe,mBAAmB,SAAUC,EAAGC,OAAQC,eAEjEC,UAAY,CAChBA,WAAuB,KACvBA,cAA0B,SAAUC,UAAWC,UAC3CC,SAASC,cAAc,IAAMH,WAAWI,iBAAiB,SACrD,WACIF,SAASG,eAAeJ,UAAUK,SAClCJ,SAASK,YAAY,YAIjCR,KAAiB,WACbA,UAAUS,WAAa,IAAIC,IAAIC,OAAOC,SAASC,MAC/ChB,EAAEM,UAAUW,GAAG,kCAAkC,SAAUC,EAAGC,aACtDA,YAAYC,SAAQ,SAAUC,SACpBC,UAAY,eAAiBD,EAAEE,UACjCF,EAAEG,QACFrB,UAAUS,WAAWa,aAAaC,OAAOJ,UAAY,aAAcD,EAAEM,UACrExB,UAAUS,WAAWa,aAAaC,OAAOJ,UAAY,UAAWD,EAAEG,OAClErB,UAAUS,WAAWa,aAAaC,OAAOJ,UAAY,SAAUD,EAAEO,UAGzE1B,UAAU2B,OAAO,kCACb,CAACC,IAAK3B,UAAUS,WAAWmB,aAAaC,MACxC,SAAUC,KAAMC,IACZhC,UAAUiC,oBAAoB,6BAA8BF,KAAMC,mBAM/E/B"}